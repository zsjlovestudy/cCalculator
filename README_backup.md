# 本地 TCP 代理服务器 - 双向数据传输与处理工具

**程序开发者**：GitHub-JYJ

**科学计算器完整功能测试并通过视频链接**：
https://www.bilibili.com/video/BV1MrKpzLEgA/?vd_source=2f6c26729a9278a478488c6c77f10eab

## 项目概述

本项目是一个运行在本地的高性能 TCP 代理服务器，专门设计用于处理客户端与服务器之间的字符串数据流,其在传输过程中自动修改数据内容：接收前端客户端发送的字符串数据并删除末尾等号=再添加结束标记<END>，再发送给后端服务器进行运算处理；接收后端服务器处理后返回的字符串数据并移除末尾结束标记<END>，适用于需要自定义协议处理的中间件场景。

## 典型应用场景

1. **协议转换中间件**：

+--------------+         +--------------+         +---------------+
|  客户端      | <-----> | 代理服务器    | <-----> | 后端服务器     |
+--------------+         +--------------+         +---------------+
                 双向交互                  双向交互                  


2. **数据清洗网关**：

- 自动修改客户端提交的数据
- 标准化服务器返回的数据格式

3. **开发调试工具**：

- 实时监控数据传输
- 验证数据完整性

## 核心功能

- **双向数据流处理**：

- 客户端 → 服务器方向：
- 自动删除数据末尾的等号 (`=`)
- 添加自定义结束标记 (`<END>`)
- 服务器 → 客户端方向：
- 自动移除结束标记 (`<END>`)

- **实时数据监控**：

- 安全打印所有传输数据（非ASCII字符显示为点）
- 详细记录每个操作的处理日志

- **连接管理**：

- 持续服务模式（处理多个客户端连接）
- 自动重连机制（单个连接失败不影响整体服务）

## 技术规格

| 项目               | 值          | 说明                      |
|--------------------|-------------|--------------------------|
| 本地监听端口        | 12345       | 客户端连接端口            |
| 目标服务器端口      | 65433       | 后端服务端口              |
| 结束标记            | `<END>`     | 5字节自定义标记          |
| 缓冲区大小          | 4096字节    | 单次处理数据上限          |
| 最大并发连接        | SOMAXCONN   | 系统允许的最大值          |

## 构建与运行

### 前提条件

- Windows 操作系统
- 支持 Winsock 2.0 的网络环境
- Visual Studio Code 文本编辑器配合 C 相关编译器

### 运行程序

## 直接运行编译后的可执行文件main.exe
```

### 测试方法

1. 启动后端服务器：运行后端服务器已打包的exe文件
2. 启动代理程序：运行main.c程序
3. 连接客户端：运行前端客户端已打包的exe文件
4. 测试数据流：
- 客户端发送：`TestData=`
- 后端接收：`TestData<END>`
- 后端发送：`Response<END>`
- 客户端接收：`Response`

### 运行时输出示例

```
服务器正在监听端口 12345 (外部连接)

正在等待客户端连接端口 12345...
外部客户端已连接: 127.0.0.1:62402 到端口 12345
正在连接到外部服务器 127.0.0.1:65433...
已成功连接到外部服务器 127.0.0.1:65433
[原始接收] 来自端口 12345 的数据: 1+2= (4 字节)
[处理前] 端口 12345 SEND: 1+2= (4 字节)
[处理] 移除末尾等号
[处理] 添加 <<END>> 标记
[处理后] 发送到端口 65433 的数据: 1+2<END> (8 字节)
[发送完成] 端口 65433 RECV: 1+2<END> (8 字节)
[原始接收] 来自端口 65433 的数据: 3<END> (6 字节)
[处理前] 端口 65433 SEND: 3<END> (6 字节)
[处理] 移除 <<END>> 标记
[处理后] 发送到端口 12345 的数据: 3 (1 字节)
[发送完成] 端口 12345 RECV: 3 (1 字节)
客户端已断开连接。准备接受新连接。

```

## 关键配置参数

在源代码中修改以下常量定义以调整服务行为：
// main.c 中的配置常量
#define SERVER_PORT 12345              // 本地监听端口
#define TARGET_SERVER_IP "127.0.0.1"   // 目标服务器IP
#define TARGET_SERVER_PORT 65433       // 目标服务器端口
#define END_MARKER "<END>"             // 自定义结束标记
#define BUFFER_SIZE 4096               // 数据传输缓冲区大小

```

## 注意事项

### 重要限制

1. **数据格式要求**：

- 仅处理 ASCII 文本数据
- 二进制数据可能导致处理错误

2. **性能考虑**：

- 单线程处理每个连接
- 不适合高并发场景（>100连接）

3. **标记处理限制**：

- 结束标记必须出现在数据末尾才被移除
- 数据中的 `<END>` 不会被处理

### 安全警告

1. **暴露风险**：

- 默认监听所有接口 (INADDR_ANY)
- 生产环境应限制为特定接口（通过修改代码绑定到指定IP）

2. **缓冲区风险**：

- 缓冲区固定大小 (4096字节)
- 超长数据会被截断并触发警告

### 故障排查

| 错误现象                  | 可能原因             | 解决方案                    |
|--------------------------|---------------------|-----------------------------|
| `bind() failed: 10048`   | 端口被占用           | 更改 SERVER_PORT 或等待释放  |
| `connect() failed: 10061`| 目标服务未启动       | 检查后端服务状态             |
| 数据传输不完整            | 缓冲区溢出           | 增大 BUFFER_SIZE            |
| 连接意外关闭              | 客户端超时           | 检查网络状况                 |

## 贡献指南

欢迎通过 GitHub Issues 提交问题或 Pull Request 贡献代码：
1. 提交功能建议
2. 报告安全漏洞
3. 改进文档
4. 优化性能

**程序开发者**：GitHub-JYJ

**科学计算器完整功能测试并通过视频链接**：
https://www.bilibili.com/video/BV1MrKpzLEgA/?vd_source=2f6c26729a9278a478488c6c77f10eab